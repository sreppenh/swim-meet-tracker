<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swim Meet Event Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 30px;
            text-align: center;
            color: white;
        }
        
        h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .content {
            padding: 30px;
        }
        
        .input-section {
            background: #f8fafc;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #4facfe;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            align-items: end;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #374151;
            font-size: 0.9em;
        }
        
        input, select {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            height: fit-content;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            padding: 8px 12px;
            font-size: 0.8em;
        }
        
        .events-list {
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }
        
        .events-header {
            background: #f9fafb;
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .events-count {
            background: #4facfe;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .event-item {
            padding: 20px;
            border-bottom: 1px solid #f1f5f9;
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 20px;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .event-item:hover {
            background-color: #f8fafc;
        }
        
        .event-item:last-child {
            border-bottom: none;
        }
        
        .event-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1em;
            min-width: 60px;
            text-align: center;
        }
        
        .event-details {
            display: flex;
            flex-direction: column;
        }
        
        .swimmer-name {
            font-weight: 600;
            font-size: 1.1em;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .event-info {
            color: #6b7280;
            font-size: 0.9em;
        }
        
        .heat-lane {
            display: flex;
            gap: 10px;
            font-size: 0.9em;
        }
        
        .heat, .lane {
            background: #e5e7eb;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        
        .empty-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .typeahead-container {
            position: relative;
        }
        
        .typeahead-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 6px 6px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .typeahead-suggestion {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #f1f5f9;
            transition: background-color 0.2s;
        }
        
        .typeahead-suggestion:hover,
        .typeahead-suggestion.selected {
            background-color: #f8fafc;
        }
        
        .typeahead-suggestion:last-child {
            border-bottom: none;
        }
        
        .view-toggle {
            display: flex;
            background: #f1f5f9;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 20px;
            gap: 4px;
        }
        
        .view-toggle button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            color: #6b7280;
        }
        
        .view-toggle button.active {
            background: white;
            color: #4facfe;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .view-section {
            display: none;
        }
        
        .view-section.active {
            display: block;
        }
        
        .completed {
            opacity: 0.6;
            text-decoration: line-through;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .custom-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .custom-checkbox.checked {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }
        
        .custom-checkbox:hover {
            border-color: #10b981;
        }
        
        .compact-event-item {
            padding: 12px 15px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: background-color 0.2s;
            min-height: auto;
        }
        
        .compact-event-item:hover {
            background-color: #f8fafc;
        }
        
        .compact-event-item:last-child {
            border-bottom: none;
        }
        
        .compact-event-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 0.9em;
            min-width: 45px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .compact-event-details {
            flex: 1;
            min-width: 0;
        }
        
        .compact-swimmer-name {
            font-weight: 600;
            font-size: 1em;
            color: #1f2937;
            margin-bottom: 2px;
        }
        
        .compact-event-info {
            color: #6b7280;
            font-size: 0.85em;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .compact-heat-lane {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }
        
        .compact-heat, .compact-lane {
            background: #e5e7eb;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
            font-size: 0.8em;
        }
        
        /* Color coding for different swimmers */
        .swimmer-color-0 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; }
        .swimmer-color-1 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) !important; }
        .swimmer-color-2 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%) !important; }
        .swimmer-color-3 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%) !important; }
        .swimmer-color-4 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%) !important; }
        .swimmer-color-5 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%) !important; color: #374151 !important; }
        .swimmer-color-6 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%) !important; color: #374151 !important; }
        .swimmer-color-7 { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%) !important; color: #374151 !important; }
        .swimmer-color-8 { background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%) !important; color: #374151 !important; }
        .swimmer-color-9 { background: linear-gradient(135deg, #ffd3a5 0%, #fd9853 100%) !important; }
        
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .splash-content {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .splash-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #374151;
            font-weight: 700;
        }
        
        .splash-subtitle {
            color: #6b7280;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .meet-setup-form {
            text-align: left;
        }
        
        .meet-setup-form .form-group {
            margin-bottom: 20px;
        }
        
        .meet-setup-form label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }
        
        .meet-setup-form input,
        .meet-setup-form select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        .meet-setup-form input:focus,
        .meet-setup-form select:focus {
            outline: none;
            border-color: #4facfe;
        }
        
        .start-meet-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s;
        }
        
        .start-meet-btn:hover {
            transform: translateY(-2px);
        }
        
        .meet-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .meet-details {
            font-weight: 600;
            color: #0369a1;
        }
        
        .change-meet-btn {
            background: #6b7280;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .change-meet-btn:hover {
            background: #4b5563;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .event-item {
                grid-template-columns: 1fr;
                gap: 15px;
                text-align: left;
            }
            
            .heat-lane {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="splashScreen" class="splash-screen">
            <div class="splash-content">
                <div class="splash-title">🏊‍♀️</div>
                <h1 class="splash-title">Swim Meet Tracker</h1>
                <p class="splash-subtitle">Set up your meet to get started</p>
                
                <form class="meet-setup-form" onsubmit="startMeet(event)">
                    <div class="form-group">
                        <label for="meetName">Meet Name</label>
                        <input type="text" id="meetName" placeholder="e.g., Winter Championship, League Finals" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="poolType">Pool Type</label>
                        <select id="poolType" required>
                            <option value="">Select pool type...</option>
                            <option value="SCY">Short Course Yards (SCY)</option>
                            <option value="SCM">Short Course Meters (SCM)</option>
                            <option value="LCM">Long Course Meters (LCM)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="meetDate">Meet Date (optional)</label>
                        <input type="date" id="meetDate">
                    </div>
                    
                    <button type="submit" class="start-meet-btn">Start Meet Tracking 🚀</button>
                </form>
            </div>
        </div>
        
        <div class="header">
            <h1>🏊‍♀️ Swim Meet Tracker</h1>
            <div class="subtitle">Keep track of all your swimmers' events</div>
        </div>
        
        <div class="content">
            <div class="meet-info" id="meetInfo" style="display: none;">
                <div class="meet-details" id="meetDetails"></div>
                <button class="change-meet-btn" onclick="changeMeet()">Change Meet</button>
            </div>
            
            <div class="view-toggle">
                <button id="addViewBtn" class="active" onclick="switchView('add')">⚙️ Manage Events</button>
                <button id="listViewBtn" onclick="switchView('list')">📋 Event List</button>
            </div>
            
            <div id="addView" class="view-section active">
                <div class="input-section">
                    <h3 style="margin-bottom: 20px; color: #374151;">Manage Events</h3>
                    <div class="form-row">
                        <div class="form-group typeahead-container">
                            <label for="swimmerName">Swimmer Name</label>
                            <input type="text" id="swimmerName" placeholder="Enter swimmer's name" autocomplete="off">
                            <div class="typeahead-suggestions" id="swimmerSuggestions"></div>
                        </div>
                        <div class="form-group">
                            <label for="eventNumber">Event #</label>
                            <input type="number" id="eventNumber" placeholder="1" min="1">
                        </div>
                        <div class="form-group">
                            <label for="heat">Heat</label>
                            <input type="number" id="heat" placeholder="1" min="1">
                        </div>
                        <div class="form-group">
                            <label for="lane">Lane</label>
                            <input type="number" id="lane" placeholder="1" min="1" max="10">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="eventName">Event Name (optional)</label>
                            <select id="eventName" onchange="checkForRelay()">
                                <option value="">Select an event...</option>
                                <optgroup label="Freestyle">
                                    <option value="25 Freestyle">25 Freestyle</option>
                                    <option value="50 Freestyle">50 Freestyle</option>
                                    <option value="100 Freestyle">100 Freestyle</option>
                                    <option value="200 Freestyle">200 Freestyle</option>
                                    <option value="400 Freestyle">400 Freestyle</option>
                                    <option value="500 Freestyle">500 Freestyle</option>
                                    <option value="800 Freestyle">800 Freestyle</option>
                                    <option value="1000 Freestyle">1000 Freestyle</option>
                                    <option value="1500 Freestyle">1500 Freestyle</option>
                                    <option value="1650 Freestyle">1650 Freestyle</option>
                                </optgroup>
                                <optgroup label="Backstroke">
                                    <option value="25 Backstroke">25 Backstroke</option>
                                    <option value="50 Backstroke">50 Backstroke</option>
                                    <option value="100 Backstroke">100 Backstroke</option>
                                    <option value="200 Backstroke">200 Backstroke</option>
                                </optgroup>
                                <optgroup label="Breaststroke">
                                    <option value="25 Breaststroke">25 Breaststroke</option>
                                    <option value="50 Breaststroke">50 Breaststroke</option>
                                    <option value="100 Breaststroke">100 Breaststroke</option>
                                    <option value="200 Breaststroke">200 Breaststroke</option>
                                </optgroup>
                                <optgroup label="Butterfly">
                                    <option value="25 Butterfly">25 Butterfly</option>
                                    <option value="50 Butterfly">50 Butterfly</option>
                                    <option value="100 Butterfly">100 Butterfly</option>
                                    <option value="200 Butterfly">200 Butterfly</option>
                                </optgroup>
                                <optgroup label="Individual Medley">
                                    <option value="100 Individual Medley">100 Individual Medley</option>
                                    <option value="200 Individual Medley">200 Individual Medley</option>
                                    <option value="400 Individual Medley">400 Individual Medley</option>
                                </optgroup>
                                <optgroup label="Relays">
                                    <option value="200 Freestyle Relay" data-relay="true">200 Freestyle Relay</option>
                                    <option value="400 Freestyle Relay" data-relay="true">400 Freestyle Relay</option>
                                    <option value="800 Freestyle Relay" data-relay="true">800 Freestyle Relay</option>
                                    <option value="200 Medley Relay" data-relay="true">200 Medley Relay</option>
                                    <option value="400 Medley Relay" data-relay="true">400 Medley Relay</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="seedTime">Seed Time (optional)</label>
                            <input type="text" id="seedTime" placeholder="e.g., 1:23.45" inputmode="decimal">
                        </div>
                        <div class="form-group" id="relayPositionGroup" style="display: none;">
                            <label for="relayPosition">Relay Position (optional)</label>
                            <select id="relayPosition">
                                <option value="">Not specified</option>
                                <option value="1">1st (Lead-off)</option>
                                <option value="2">2nd</option>
                                <option value="3">3rd</option>
                                <option value="4">4th (Anchor)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" onclick="addEvent()">Add Event</button>
                        </div>
                    </div>
                </div>
                
                <!-- Events management list for editing -->
                <div class="events-list">
                    <div class="events-header">
                        <h3 style="color: #374151;">All Events</h3>
                        <span class="events-count" id="manageEventCount">0 events</span>
                    </div>
                    <div id="manageEventsList">
                        <div class="empty-state">
                            <div class="empty-icon">🏊‍♂️</div>
                            <h4>No events added yet</h4>
                            <p>Add your first swimmer's event above!</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="listView" class="view-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #374151;">Event Checklist</h3>
                    <button class="btn" onclick="shareEventList()" style="background: #10b981;">📤 Share List</button>
                </div>
                
                <!-- Compact event list for checking off -->
                <div class="events-list" style="border: none;">
                    <div id="checklistEventsList">
                        <div class="empty-state">
                            <div class="empty-icon">🏊‍♂️</div>
                            <h4>No events to track</h4>
                            <p>Add events in the Manage Events tab first!</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="events-list" style="display: none;">
                <div class="events-header">
                    <h3 style="color: #374151;">Upcoming Events</h3>
                    <span class="events-count" id="eventCount">0 events</span>
                </div>
                <div id="eventsList">
                    <div class="empty-state">
                        <div class="empty-icon">🏊‍♂️</div>
                        <h4>No events added yet</h4>
                        <p>Add your first swimmer's event above to get started!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let events = [];
        let selectedSuggestionIndex = -1;
        let currentView = 'add';
        let currentMeet = null;
        // Need to add swimmerColors back since we're still using it for the color-coded event numbers
        let swimmerColors = {}; // Track color assignments for each swimmer
        let nextColorIndex = 0;
        let swimmerEmojis = {}; // Track emoji assignments for each swimmer
        const availableEmojis = ['🐬', '🦈', '🐙', '🐠', '🐟', '🦭', '🐳', '🦑', '🌊', '⭐', '🚀', '⚡', '🔥', '💎', '🎯', '🏆', '🎪', '🎨', '🎭', '🎸'];
        let nextEmojiIndex = 0;

        // Your children's names for typeahead
        const myChildren = ["Bridget", "Blake", "Connor"];

        // Common swim events for typeahead
        const commonEvents = [
            "25 Freestyle", "50 Freestyle", "100 Freestyle", "200 Freestyle", "400 Freestyle", "500 Freestyle", "800 Freestyle", "1000 Freestyle", "1500 Freestyle", "1650 Freestyle",
            "25 Backstroke", "50 Backstroke", "100 Backstroke", "200 Backstroke",
            "25 Breaststroke", "50 Breaststroke", "100 Breaststroke", "200 Breaststroke",
            "25 Butterfly", "50 Butterfly", "100 Butterfly", "200 Butterfly",
            "100 Individual Medley", "200 Individual Medley", "400 Individual Medley",
            "200 Freestyle Relay", "400 Freestyle Relay", "800 Freestyle Relay",
            "200 Medley Relay", "400 Medley Relay"
        ];

        // Helper functions - defined first to avoid reference errors
        function checkForRelay() {
            try {
                const eventSelect = document.getElementById('eventName');
                const selectedOption = eventSelect.options[eventSelect.selectedIndex];
                const relayPositionGroup = document.getElementById('relayPositionGroup');
                
                if (selectedOption && selectedOption.hasAttribute('data-relay')) {
                    relayPositionGroup.style.display = 'block';
                } else {
                    relayPositionGroup.style.display = 'none';
                    document.getElementById('relayPosition').value = '';
                }
            } catch (error) {
                console.error('Error in checkForRelay:', error);
            }
        }

        function getSwimmerColor(swimmerName) {
            if (!swimmerColors[swimmerName]) {
                swimmerColors[swimmerName] = nextColorIndex % 10;
                nextColorIndex++;
            }
            return swimmerColors[swimmerName];
        }

        function getSwimmerEmoji(swimmerName) {
            if (!swimmerEmojis[swimmerName]) {
                swimmerEmojis[swimmerName] = availableEmojis[nextEmojiIndex % availableEmojis.length];
                nextEmojiIndex++;
            }
            return swimmerEmojis[swimmerName];
        }

        function isRelayEvent(eventName) {
            if (!eventName) return false;
            // Check if it's one of the relay events
            const relayEvents = ['200 Freestyle Relay', '400 Freestyle Relay', '800 Freestyle Relay', '200 Medley Relay', '400 Medley Relay'];
            return relayEvents.includes(eventName);
        }

        function getEventIcon(eventName, relayPosition) {
            const isRelay = isRelayEvent(eventName);
            if (isRelay) {
                return relayPosition ? `🤝 (${relayPosition})` : '🤝';
            }
            return '🏊‍♀️';
        }

        function startMeet(event) {
            event.preventDefault();
            
            const meetName = document.getElementById('meetName').value.trim();
            const poolType = document.getElementById('poolType').value;
            const meetDate = document.getElementById('meetDate').value;
            
            if (!meetName || !poolType) {
                alert('Please fill in meet name and pool type');
                return;
            }
            
            currentMeet = {
                name: meetName,
                poolType: poolType,
                date: meetDate
            };
            
            // Hide splash screen
            document.getElementById('splashScreen').style.display = 'none';
            
            // Show meet info
            updateMeetInfo();
        }
        
        function changeMeet() {
            if (events.length > 0) {
                if (!confirm('Changing the meet will clear all current events. Continue?')) {
                    return;
                }
                events = [];
                renderEvents();
            }
            
            // Reset form
            document.getElementById('meetName').value = '';
            document.getElementById('poolType').value = '';
            document.getElementById('meetDate').value = '';
            
            // Show splash screen
            document.getElementById('splashScreen').style.display = 'flex';
            document.getElementById('meetInfo').style.display = 'none';
        }
        
        function updateMeetInfo() {
            const meetInfo = document.getElementById('meetInfo');
            const meetDetails = document.getElementById('meetDetails');
            
            if (currentMeet) {
                const dateStr = currentMeet.date ? ` • ${new Date(currentMeet.date).toLocaleDateString()}` : '';
                meetDetails.textContent = `${currentMeet.name} (${currentMeet.poolType})${dateStr}`;
                meetInfo.style.display = 'flex';
            }
        }

        function switchView(view) {
            currentView = view;
            
            // Update button states
            document.getElementById('addViewBtn').classList.toggle('active', view === 'add');
            document.getElementById('listViewBtn').classList.toggle('active', view === 'list');
            
            // Update view sections
            document.getElementById('addView').classList.toggle('active', view === 'add');
            document.getElementById('listView').classList.toggle('active', view === 'list');
        }

        function setupTypeahead() {
            // No typeahead needed anymore - simple inputs
        }

        function setupSwimmerNameTypeahead() {
            const swimmerNameInput = document.getElementById('swimmerName');
            const suggestionsDiv = document.getElementById('swimmerSuggestions');

            swimmerNameInput.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                
                if (query.length === 0) {
                    hideSwimmerSuggestions();
                    return;
                }

                const matches = myChildren.filter(name => 
                    name.toLowerCase().includes(query)
                );

                if (matches.length > 0) {
                    showSwimmerSuggestions(matches);
                } else {
                    hideSwimmerSuggestions();
                }
            });

            swimmerNameInput.addEventListener('keydown', function(e) {
                const suggestions = suggestionsDiv.querySelectorAll('.typeahead-suggestion');
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    selectedSuggestionIndex = Math.min(selectedSuggestionIndex + 1, suggestions.length - 1);
                    updateSelection(suggestions);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    selectedSuggestionIndex = Math.max(selectedSuggestionIndex - 1, -1);
                    updateSelection(suggestions);
                } else if (e.key === 'Enter' && selectedSuggestionIndex >= 0) {
                    e.preventDefault();
                    const selectedText = suggestions[selectedSuggestionIndex].textContent;
                    selectSwimmerSuggestion(selectedText);
                } else if (e.key === 'Escape') {
                    hideSwimmerSuggestions();
                }
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!swimmerNameInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    hideSwimmerSuggestions();
                }
            });
        }

        function showSwimmerSuggestions(matches) {
            const suggestionsDiv = document.getElementById('swimmerSuggestions');
            suggestionsDiv.innerHTML = matches.map(match => 
                `<div class="typeahead-suggestion" onclick="selectSwimmerSuggestion('${match}')">${match}</div>`
            ).join('');
            suggestionsDiv.style.display = 'block';
        }

        function hideSwimmerSuggestions() {
            const suggestionsDiv = document.getElementById('swimmerSuggestions');
            suggestionsDiv.style.display = 'none';
            selectedSuggestionIndex = -1;
        }

        function selectSwimmerSuggestion(name) {
            document.getElementById('swimmerName').value = name;
            hideSwimmerSuggestions();
        }

        function setupEventNameTypeahead() {
            const eventNameInput = document.getElementById('eventName');
            const suggestionsDiv = document.getElementById('eventSuggestions');

            if (!eventNameInput || !suggestionsDiv) return;

            eventNameInput.addEventListener('input', function() {
                try {
                    const query = this.value.toLowerCase().trim();
                    selectedSuggestionIndex = -1;
                    
                    if (query.length === 0) {
                        hideSuggestions();
                        checkForRelay();
                        return;
                    }

                    const matches = commonEvents.filter(event => 
                        event.toLowerCase().includes(query)
                    ).slice(0, 8); // Limit to 8 suggestions

                    if (matches.length > 0) {
                        showSuggestions(matches);
                    } else {
                        hideSuggestions();
                    }
                    
                    checkForRelay();
                } catch (error) {
                    console.error('Error in event name input:', error);
                }
            });

            eventNameInput.addEventListener('change', function() {
                try {
                    checkForRelay();
                } catch (error) {
                    console.error('Error in event name change:', error);
                }
            });

            eventNameInput.addEventListener('keydown', function(e) {
                try {
                    const suggestions = suggestionsDiv.querySelectorAll('.typeahead-suggestion');
                    
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        selectedSuggestionIndex = Math.min(selectedSuggestionIndex + 1, suggestions.length - 1);
                        updateSelection(suggestions);
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        selectedSuggestionIndex = Math.max(selectedSuggestionIndex - 1, -1);
                        updateSelection(suggestions);
                    } else if (e.key === 'Enter' && selectedSuggestionIndex >= 0) {
                        e.preventDefault();
                        const selectedText = suggestions[selectedSuggestionIndex].textContent;
                        selectSuggestion(selectedText);
                    } else if (e.key === 'Escape') {
                        hideSuggestions();
                    }
                } catch (error) {
                    console.error('Error in event name keydown:', error);
                }
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                try {
                    if (!eventNameInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                        hideSuggestions();
                    }
                } catch (error) {
                    console.error('Error in document click:', error);
                }
            });
        }

        function showSuggestions(matches) {
            try {
                const suggestionsDiv = document.getElementById('eventSuggestions');
                if (!suggestionsDiv) return;
                
                suggestionsDiv.innerHTML = matches.map(match => 
                    `<div class="typeahead-suggestion" onclick="selectSuggestionSafe('${match.replace(/'/g, "\\'")})">${match}</div>`
                ).join('');
                suggestionsDiv.style.display = 'block';
            } catch (error) {
                console.error('Error showing suggestions:', error);
            }
        }

        function hideSuggestions() {
            try {
                const suggestionsDiv = document.getElementById('eventSuggestions');
                if (suggestionsDiv) {
                    suggestionsDiv.style.display = 'none';
                    selectedSuggestionIndex = -1;
                }
            } catch (error) {
                console.error('Error hiding suggestions:', error);
            }
        }

        function selectSuggestionSafe(eventName) {
            try {
                selectSuggestion(eventName);
            } catch (error) {
                console.error('Error in selectSuggestionSafe:', error);
            }
        }

        function updateSelection(suggestions) {
            suggestions.forEach((suggestion, index) => {
                suggestion.classList.toggle('selected', index === selectedSuggestionIndex);
            });
        }

        function selectSuggestion(eventName) {
            try {
                document.getElementById('eventName').value = eventName;
                hideSuggestions();
                // Use setTimeout to ensure DOM is updated before checking
                setTimeout(function() {
                    checkForRelay();
                }, 10);
            } catch (error) {
                console.error('Error in selectSuggestion:', error);
            }
        }

        function addEvent() {
            const swimmerName = document.getElementById('swimmerName').value.trim();
            const eventNumber = parseInt(document.getElementById('eventNumber').value);
            const heat = parseInt(document.getElementById('heat').value);
            const lane = parseInt(document.getElementById('lane').value);
            const eventName = document.getElementById('eventName').value.trim();
            const seedTime = document.getElementById('seedTime').value.trim();
            const relayPosition = document.getElementById('relayPosition').value;

            // Validation
            if (!swimmerName) {
                alert('Please enter the swimmer\'s name');
                return;
            }
            if (!eventNumber || eventNumber < 1) {
                alert('Please enter a valid event number');
                return;
            }
            if (!heat || heat < 1) {
                alert('Please enter a valid heat number');
                return;
            }
            if (!lane || lane < 1 || lane > 10) {
                alert('Please enter a valid lane number (1-10)');
                return;
            }

            // Create event object
            const event = {
                id: Date.now(),
                swimmerName,
                eventNumber,
                heat,
                lane,
                eventName,
                seedTime,
                relayPosition,
                completed: false
            };

            events.push(event);
            clearFormExceptSwimmer();
            renderEvents();
            
            // Stay on manage events page - don't auto-switch
        }

        function clearFormExceptSwimmer() {
            // Keep the swimmer name, clear everything else
            document.getElementById('eventNumber').value = '';
            document.getElementById('heat').value = '';
            document.getElementById('lane').value = '';
            document.getElementById('eventName').value = '';
            document.getElementById('seedTime').value = '';
            document.getElementById('relayPosition').value = '';
            checkForRelay();
        }

        function toggleEventCompleted(id) {
            const event = events.find(e => e.id === id);
            if (event) {
                event.completed = !event.completed;
                renderEvents();
            }
        }

        function shareEventList() {
            try {
                const sortedEvents = [...events].sort((a, b) => a.eventNumber - b.eventNumber);
                
                if (sortedEvents.length === 0) {
                    alert('No events to share! Add some events first.');
                    return;
                }
                
                let shareText = `🏊‍♀️ ${currentMeet ? currentMeet.name : 'Swim Meet'} Event List\n`;
                if (currentMeet && currentMeet.poolType) {
                    shareText += `Pool: ${currentMeet.poolType}\n`;
                }
                if (currentMeet && currentMeet.date) {
                    shareText += `Date: ${new Date(currentMeet.date).toLocaleDateString()}\n`;
                }
                shareText += '\n';

                sortedEvents.forEach(event => {
                    const swimmerEmoji = getSwimmerEmoji(event.swimmerName);
                    const relayInfo = isRelayEvent(event.eventName) && event.relayPosition ? ` (Position ${event.relayPosition})` : '';
                    const seedInfo = event.seedTime ? ` - Seed: ${event.seedTime}` : '';
                    
                    shareText += `${swimmerEmoji} Event ${event.eventNumber}: ${event.swimmerName}\n`;
                    shareText += `   ${event.eventName || 'Event ' + event.eventNumber}${relayInfo}\n`;
                    shareText += `   Heat ${event.heat}, Lane ${event.lane}${seedInfo}\n\n`;
                });

                // Check if we're in a proper browser context (not embedded iframe)
                const isEmbedded = window !== window.top;
                
                // Use Web Share API only if available and not embedded
                if (navigator.share && !isEmbedded && window.isSecureContext) {
                    navigator.share({
                        title: `${currentMeet ? currentMeet.name : 'Swim Meet'} Event List`,
                        text: shareText
                    }).catch(err => {
                        console.log('Share cancelled or failed:', err);
                        fallbackShare(shareText);
                    });
                } else {
                    // Use fallback for embedded contexts or when share isn't available
                    fallbackShare(shareText);
                }
            } catch (error) {
                console.error('Error sharing event list:', error);
                alert('Unable to share event list. Try again.');
            }
        }

        function fallbackShare(text) {
            // Always use clipboard fallback since web share doesn't work in embedded environments
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Event list copied to clipboard! You can now paste it into a text message or email.');
                }).catch(() => {
                    showTextModal(text);
                });
            } else {
                showTextModal(text);
            }
        }

        function showTextModal(text) {
            // Create a modal to show the text for manual copying
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.8); z-index: 3000;
                display: flex; align-items: center; justify-content: center;
                padding: 20px;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white; border-radius: 12px; padding: 20px;
                max-width: 500px; max-height: 80vh; overflow-y: auto;
            `;
            
            content.innerHTML = `
                <h3 style="margin-bottom: 15px;">Event List Ready to Share</h3>
                <textarea readonly style="width: 100%; height: 300px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-family: monospace; font-size: 12px; resize: vertical;">${text}</textarea>
                <div style="margin-top: 15px; text-align: center;">
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: #4facfe; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">Close</button>
                </div>
                <p style="margin-top: 10px; font-size: 12px; color: #666; text-align: center;">
                    Select all text above and copy to share via text or email
                </p>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Select the text automatically
            const textarea = content.querySelector('textarea');
            textarea.select();
        }

        function removeEvent(id) {
            events = events.filter(event => event.id !== id);
            renderEvents();
        }

        function clearForm() {
            document.getElementById('swimmerName').value = '';
            document.getElementById('eventNumber').value = '';
            document.getElementById('heat').value = '';
            document.getElementById('lane').value = '';
            document.getElementById('eventName').value = '';
            document.getElementById('seedTime').value = '';
            document.getElementById('relayPosition').value = '';
            checkForRelay();
        }

        function clearCompleted() {
            const completedCount = events.filter(e => e.completed).length;
            if (completedCount === 0) {
                alert('No completed events to clear.');
                return;
            }
            if (confirm(`Clear ${completedCount} completed event${completedCount !== 1 ? 's' : ''}?`)) {
                events = events.filter(event => !event.completed);
                renderEvents();
            }
        }

        function clearAll() {
            if (events.length === 0) return;
            if (confirm('Are you sure you want to clear all events? This will prepare for a new meet.')) {
                events = [];
                renderEvents();
            }
        }

        function renderEvents() {
            renderManageEventsList();
            renderChecklistEventsList();
        }

        function renderManageEventsList() {
            const eventsList = document.getElementById('manageEventsList');
            const eventCount = document.getElementById('manageEventCount');
            
            // Sort events by event number
            const sortedEvents = [...events].sort((a, b) => a.eventNumber - b.eventNumber);
            
            // Update count
            eventCount.textContent = `${events.length} event${events.length !== 1 ? 's' : ''}`;
            
            if (sortedEvents.length === 0) {
                eventsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🏊‍♂️</div>
                        <h4>No events added yet</h4>
                        <p>Add your first swimmer's event above!</p>
                    </div>
                `;
                return;
            }

            eventsList.innerHTML = sortedEvents.map(event => `
                <div class="compact-event-item ${event.completed ? 'completed' : ''}">
                    <div class="compact-event-number swimmer-color-${getSwimmerColor(event.swimmerName)}">${event.eventNumber}</div>
                    <div class="compact-event-details">
                        <div class="compact-swimmer-name">
                            ${event.swimmerName} ${getEventIcon(event.eventName, event.relayPosition)}
                        </div>
                        <div class="compact-event-info">
                            <span>${event.eventName || 'Event ' + event.eventNumber}</span>
                            ${event.seedTime ? `<span>Seed: ${event.seedTime}</span>` : ''}
                        </div>
                    </div>
                    <div class="compact-heat-lane">
                        <span class="compact-heat">H${event.heat}</span>
                        <span class="compact-lane">L${event.lane}</span>
                    </div>
                    <button class="btn btn-danger" onclick="removeEvent(${event.id})" style="padding: 6px 10px; font-size: 0.8em;">Remove</button>
                </div>
            `).join('');
        }

        function renderChecklistEventsList() {
            const eventsList = document.getElementById('checklistEventsList');
            
            // Sort events by event number
            const sortedEvents = [...events].sort((a, b) => a.eventNumber - b.eventNumber);
            
            if (sortedEvents.length === 0) {
                eventsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🏊‍♂️</div>
                        <h4>No events to track</h4>
                        <p>Add events in the Manage Events tab first!</p>
                    </div>
                `;
                return;
            }

            eventsList.innerHTML = sortedEvents.map(event => `
                <div class="compact-event-item ${event.completed ? 'completed' : ''}">
                    <div class="custom-checkbox ${event.completed ? 'checked' : ''}" onclick="toggleEventCompleted(${event.id})">
                        ${event.completed ? '✓' : ''}
                    </div>
                    <div class="compact-event-number swimmer-color-${getSwimmerColor(event.swimmerName)}">${event.eventNumber}</div>
                    <div class="compact-event-details">
                        <div class="compact-swimmer-name">
                            ${event.swimmerName} ${getEventIcon(event.eventName, event.relayPosition)}
                        </div>
                        <div class="compact-event-info">
                            <span>${event.eventName || 'Event ' + event.eventNumber}</span>
                            ${event.seedTime ? `<span>Seed: ${event.seedTime}</span>` : ''}
                        </div>
                    </div>
                    <div class="compact-heat-lane">
                        <span class="compact-heat">H${event.heat}</span>
                        <span class="compact-lane">L${event.lane}</span>
                    </div>
                </div>
            `).join('');
        }

        // Allow Enter key to add event
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addEvent();
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setupTypeahead();
            renderEvents();
        });
    </script>
</body>
</html>
